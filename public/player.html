<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–º–µ—Ö–ª—ã—Å—Ç - –ò–≥—Ä–æ–∫</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="player-body">
    <div class="mobile-container">
        
        <!-- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï -->
        <div id="join" class="mobile-screen active">
            <div class="mobile-header">
                <h1 class="mobile-logo">üé≠ –°–ú–ï–•–õ–´–°–¢</h1>
            </div>
            
            <div class="join-card">
                <div class="input-group">
                    <label class="input-label">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã</label>
                    <input type="text" id="roomCodeInput" class="mobile-input code-input" 
                           placeholder="XXXX" maxlength="4" autocomplete="off">
                </div>

                <div class="input-group">
                    <label class="input-label">–í–∞—à–µ –∏–º—è</label>
                    <input type="text" id="playerNameInput" class="mobile-input" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" maxlength="15" autocomplete="off">
                </div>

                <div class="input-group">
                    <label class="input-label">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤–∞—Ç–∞—Ä</label>
                    <div class="avatar-picker" id="avatarPicker">
                        <button class="avatar-option active" data-avatar="üòÄ">üòÄ</button>
                        <button class="avatar-option" data-avatar="üòé">üòé</button>
                        <button class="avatar-option" data-avatar="ü§ì">ü§ì</button>
                        <button class="avatar-option" data-avatar="üò∫">üò∫</button>
                        <button class="avatar-option" data-avatar="ü¶ä">ü¶ä</button>
                        <button class="avatar-option" data-avatar="üê∂">üê∂</button>
                        <button class="avatar-option" data-avatar="üêº">üêº</button>
                        <button class="avatar-option" data-avatar="ü¶Å">ü¶Å</button>
                        <button class="avatar-option" data-avatar="ü§°">ü§°</button>
                        <button class="avatar-option" data-avatar="üëΩ">üëΩ</button>
                        <button class="avatar-option" data-avatar="ü§ñ">ü§ñ</button>
                        <button class="avatar-option" data-avatar="üëæ">üëæ</button>
                    </div>
                </div>

                <button class="mobile-button primary" onclick="joinGame()">
                    –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                </button>
            </div>
        </div>

        <!-- –û–ñ–ò–î–ê–ù–ò–ï -->
        <div id="waiting" class="mobile-screen">
            <div class="status-card">
                <div class="status-icon success">‚úÖ</div>
                <h2 class="status-title">–í—ã –≤ –∏–≥—Ä–µ!</h2>
                <div class="player-display" id="playerDisplay"></div>
                
                <div class="dots-animation">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
                
                <p class="status-text">–û–∂–∏–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã...</p>
            </div>
        </div>

        <!-- –û–¢–í–ï–¢ -->
        <div id="answering" class="mobile-screen">
            <div class="question-card-mobile">
                <div class="question-icon-mobile">‚ùì</div>
                <h3 class="question-text-mobile" id="mobileQuestion"></h3>
            </div>

            <div class="answer-input-card">
                <textarea id="answerTextarea" class="answer-textarea" 
                          placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∞–º—ã–π —Å–º–µ—à–Ω–æ–π –æ—Ç–≤–µ—Ç..." 
                          maxlength="100"></textarea>
                <div class="char-count">
                    <span id="charCount">0</span>/100
                </div>
                <button class="mobile-button success big-btn" onclick="submitAnswer()">
                    üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
            </div>
        </div>

        <!-- –û–¢–ü–†–ê–í–õ–ï–ù–û -->
        <div id="submitted" class="mobile-screen">
            <div class="status-card">
                <div class="status-icon success pulse">‚ú®</div>
                <h2 class="status-title">–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</h2>
                
                <div class="answer-preview-card">
                    <p class="preview-label">–í–∞—à –æ—Ç–≤–µ—Ç:</p>
                    <p class="preview-text" id="previewText"></p>
                </div>

                <div class="dots-animation">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
                
                <p class="status-text">–ñ–¥—ë–º –æ—Å—Ç–∞–ª—å–Ω—ã—Ö...</p>
            </div>
        </div>

        <!-- –ì–û–õ–û–°–û–í–ê–ù–ò–ï -->
        <div id="voting" class="mobile-screen">
            <div class="vote-header">
                <h2 class="vote-title-mobile">üó≥Ô∏è –ì–æ–ª–æ—Å—É–π—Ç–µ!</h2>
                <p class="vote-question-mobile" id="voteQuestion"></p>
            </div>

            <div class="vote-options" id="voteOptions"></div>
        </div>

        <!-- –ì–û–õ–û–° –û–¢–î–ê–ù -->
        <div id="voted" class="mobile-screen">
            <div class="status-card">
                <div class="status-icon success pulse">üó≥Ô∏è</div>
                <h2 class="status-title">–ì–æ–ª–æ—Å –ø—Ä–∏–Ω—è—Ç!</h2>
                
                <div class="dots-animation">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </div>
                
                <p class="status-text">–ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
            </div>
        </div>

        <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ -->
        <div id="results" class="mobile-screen">
            <div class="my-result-card" id="myResult"></div>
        </div>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let selectedAvatar = 'üòÄ';
        let playerId = null;

        // –í—ã–±–æ—Ä –∞–≤–∞—Ç–∞—Ä–∞
        document.querySelectorAll('.avatar-option').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.avatar-option').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedAvatar = this.dataset.avatar;
            });
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –∏–º–µ–Ω–∏ –ø–æ—Å–ª–µ –∫–æ–¥–∞
        document.getElementById('roomCodeInput').addEventListener('input', function(e) {
            this.value = this.value.toUpperCase();
            if (this.value.length === 4) {
                document.getElementById('playerNameInput').focus();
            }
        });

        // –ü–æ–¥—Å—á–µ—Ç —Å–∏–º–≤–æ–ª–æ–≤
        document.getElementById('answerTextarea')?.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
        function joinGame() {
            const roomCode = document.getElementById('roomCodeInput').value.trim().toUpperCase();
            const name = document.getElementById('playerNameInput').value.trim();

            if (!roomCode || roomCode.length !== 4) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (4 —Å–∏–º–≤–æ–ª–∞)');
                return;
            }

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }

            socket.emit('joinGame', { roomCode, name, avatar: selectedAvatar });
        }

        socket.on('joinSuccess', (player) => {
            playerId = player.id;
            document.getElementById('playerDisplay').innerHTML = `
                <div class="player-avatar-display">${player.avatar}</div>
                <div class="player-name-display">${player.name}</div>
            `;
            showScreen('waiting');
            vibrate();
        });

        socket.on('error', (msg) => {
            alert(msg);
        });

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        socket.on('gameStarted', (data) => {
            document.getElementById('mobileQuestion').textContent = data.question;
            document.getElementById('answerTextarea').value = '';
            document.getElementById('charCount').textContent = '0';
            showScreen('answering');
            vibrate();
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
        function submitAnswer() {
            const answer = document.getElementById('answerTextarea').value.trim();
            if (!answer) {
                alert('–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç!');
                return;
            }

            socket.emit('submitAnswer', answer);
            document.getElementById('previewText').textContent = answer;
            showScreen('submitted');
            vibrate();
        }

        // –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
        socket.on('votingStarted', (data) => {
            document.getElementById('voteQuestion').textContent = data.question;
            
            const options = document.getElementById('voteOptions');
            options.innerHTML = data.answers.map(a => `
                <button class="vote-option-btn" onclick="vote('${a.id}')">
                    <div class="vote-option-text">${a.text}</div>
                </button>
            `).join('');
            
            showScreen('voting');
            vibrate();
        });

        function vote(answerId) {
            if (answerId === playerId) {
                alert('–ù–µ–ª—å–∑—è –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —Å–≤–æ–π –æ—Ç–≤–µ—Ç!');
                return;
            }
            socket.emit('vote', answerId);
            showScreen('voted');
            vibrate();
        }

        // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
        socket.on('roundResults', (results) => {
            const myResult = results.find(r => r.id === playerId);
            if (myResult) {
                const isWinner = results[0].id === playerId;
                document.getElementById('myResult').innerHTML = `
                    <div class="result-icon">${isWinner ? 'üèÜ' : myResult.votes > 0 ? 'üéâ' : 'üòÖ'}</div>
                    <h3 class="result-title">${isWinner ? '–í—ã –ø–æ–±–µ–¥–∏–ª–∏!' : '–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç'}</h3>
                    <div class="result-answer-display">"${myResult.answer}"</div>
                    <div class="result-stats">
                        <div class="stat-item">
                            <div class="stat-value">${myResult.votes}</div>
                            <div class="stat-label">–≥–æ–ª–æ—Å–æ–≤</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${myResult.score}</div>
                            <div class="stat-label">–æ—á–∫–æ–≤</div>
                        </div>
                    </div>
                `;
                
                if (isWinner) vibrate([100, 50, 100, 50, 200]);
            }
            showScreen('results');
        });

        socket.on('newRound', (data) => {
            document.getElementById('mobileQuestion').textContent = data.question;
            document.getElementById('answerTextarea').value = '';
            document.getElementById('charCount').textContent = '0';
            showScreen('answering');
            vibrate();
        });

        socket.on('gameFinished', () => {
            setTimeout(() => {
                alert('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–≥—Ä—É!');
                showScreen('join');
            }, 5000);
        });

        socket.on('hostLeft', () => {
            alert('–•–æ—Å—Ç –ø–æ–∫–∏–Ω—É–ª –∏–≥—Ä—É!');
            location.reload();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId) {
            document.querySelectorAll('.mobile-screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // –í–∏–±—Ä–∞—Ü–∏—è
        function vibrate(pattern = 50) {
            if (navigator.vibrate) {
                navigator.vibrate(pattern);
            }
        }
    </script>
</body>
</html>