<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–º–µ—Ö–ª—ã—Å—Ç - –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="host-body">
    <!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω -->
    <div class="animated-bg">
        <div class="bg-shape shape-1"></div>
        <div class="bg-shape shape-2"></div>
        <div class="bg-shape shape-3"></div>
        <div class="bg-shape shape-4"></div>
    </div>

    <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
    <div id="menu" class="screen active">
        <div class="menu-content">
            <div class="logo-animation">
                <div class="logo-circle"></div>
                <h1 class="game-title">
                    <span class="title-icon">üé≠</span>
                    <span class="title-text">–°–ú–ï–•–õ–´–°–¢</span>
                </h1>
                <p class="game-subtitle">–ë–∏—Ç–≤–∞ –æ—Å—Ç—Ä–æ—Å–ª–æ–≤–æ–≤</p>
            </div>
            
            <div class="menu-buttons-container">
                <button class="mega-button primary-btn" onclick="createGame()">
                    <span class="btn-bg"></span>
                    <span class="btn-content">
                        <span class="btn-icon">üéÆ</span>
                        <span class="btn-text">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</span>
                    </span>
                </button>
            </div>

            <div class="menu-footer">
                <div class="info-badge">
                    <span class="badge-icon">üë•</span>
                    <span>2-8 –∏–≥—Ä–æ–∫–æ–≤</span>
                </div>
                <div class="info-badge">
                    <span class="badge-icon">‚è±Ô∏è</span>
                    <span>10-15 –º–∏–Ω—É—Ç</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –õ–û–ë–ë–ò -->
    <div id="lobby" class="screen">
        <div class="lobby-content">
            <div class="lobby-header">
                <h2 class="screen-title pulse-animation">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –∏–≥—Ä–µ!</h2>
            </div>

            <div class="room-code-display">
                <div class="code-label">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</div>
                <div class="code-value" id="roomCode">----</div>
                <div class="code-hint">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</div>
            </div>

            <div class="players-container">
                <div class="players-header">
                    <h3>–ò–≥—Ä–æ–∫–∏ (<span id="playerCount">0</span>/8)</h3>
                </div>
                <div class="players-grid" id="playersGrid">
                    <div class="waiting-player">
                        <div class="waiting-icon">‚è≥</div>
                        <div class="waiting-text">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
                    </div>
                </div>
            </div>

            <div class="lobby-actions">
                <button class="mega-button success-btn" id="startGameBtn" onclick="startGame()" disabled>
                    <span class="btn-bg"></span>
                    <span class="btn-content">
                        <span class="btn-icon">‚ñ∂Ô∏è</span>
                        <span class="btn-text">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- –ò–ì–†–ê - –í–û–ü–†–û–° -->
    <div id="question" class="screen">
        <div class="game-content">
            <div class="round-badge">
                <span>–†–∞—É–Ω–¥ <span id="currentRound">1</span>/<span id="totalRounds">7</span></span>
            </div>

            <div class="question-display">
                <div class="question-card-big">
                    <div class="question-decoration">
                        <span class="q-mark">?</span>
                    </div>
                    <h2 class="question-text" id="questionText"></h2>
                </div>
            </div>

            <div class="answer-progress">
                <div class="progress-label">–û—Ç–≤–µ—Ç–∏–ª–∏ –∏–≥—Ä–æ–∫–æ–≤:</div>
                <div class="progress-numbers">
                    <span id="answeredCount">0</span>/<span id="totalPlayers">0</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="answerProgressBar"></div>
                </div>
                <div class="progress-players" id="answeredPlayers"></div>
            </div>
        </div>
    </div>

    <!-- –ì–û–õ–û–°–û–í–ê–ù–ò–ï -->
    <div id="voting" class="screen">
        <div class="game-content">
            <h2 class="screen-title vote-title">
                <span class="vote-icon">üó≥Ô∏è</span>
                –ì–æ–ª–æ—Å—É–π—Ç–µ!
            </h2>

            <div class="question-card-small">
                <p id="votingQuestion"></p>
            </div>

            <div class="answers-showcase" id="answersShowcase"></div>

            <div class="vote-counter">
                <div class="vote-label">–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–æ:</div>
                <div class="vote-numbers">
                    <span id="votedCount">0</span>/<span id="totalVoters">0</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill rainbow" id="voteProgressBar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- –†–ï–ó–£–õ–¨–¢–ê–¢–´ –†–ê–£–ù–î–ê -->
    <div id="results" class="screen">
        <div class="game-content">
            <h2 class="screen-title">
                <span class="trophy-spin">üèÜ</span>
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—É–Ω–¥–∞
            </h2>

            <div class="results-podium" id="resultsPodium"></div>

            <button class="mega-button primary-btn" onclick="nextRound()">
                <span class="btn-bg"></span>
                <span class="btn-content">
                    <span class="btn-icon">‚û°Ô∏è</span>
                    <span class="btn-text">–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥</span>
                </span>
            </button>
        </div>
    </div>

    <!-- –§–ò–ù–ê–õ -->
    <div id="final" class="screen">
        <div class="game-content">
            <h2 class="screen-title celebration">
                <span class="confetti">üéâ</span>
                –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!
                <span class="confetti">üéä</span>
            </h2>

            <div class="final-podium" id="finalPodium"></div>

            <div class="final-actions">
                <button class="mega-button primary-btn" onclick="location.reload()">
                    <span class="btn-bg"></span>
                    <span class="btn-content">
                        <span class="btn-icon">üîÑ</span>
                        <span class="btn-text">–ù–æ–≤–∞—è –∏–≥—Ä–∞</span>
                    </span>
                </button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let roomCode = null;

        // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã
        function createGame() {
            socket.emit('createGame');
        }

        socket.on('gameCreated', (data) => {
            roomCode = data.roomCode;
            document.getElementById('roomCode').textContent = roomCode;
            showScreen('lobby');
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤
        socket.on('playerJoined', (data) => {
            updatePlayers(data.players);
            playSound('join');
        });

        function updatePlayers(players) {
            const grid = document.getElementById('playersGrid');
            document.getElementById('playerCount').textContent = players.length;
            
            if (players.length === 0) {
                grid.innerHTML = `
                    <div class="waiting-player">
                        <div class="waiting-icon">‚è≥</div>
                        <div class="waiting-text">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</div>
                    </div>
                `;
            } else {
                grid.innerHTML = players.map((p, i) => `
                    <div class="player-item" style="animation-delay: ${i * 0.1}s">
                        <div class="player-avatar-big">${p.avatar}</div>
                        <div class="player-name">${p.name}</div>
                        <div class="player-status">‚úÖ –ì–æ—Ç–æ–≤</div>
                    </div>
                `).join('');
            }

            document.getElementById('startGameBtn').disabled = players.length < 2;
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            socket.emit('startGame');
        }

        socket.on('gameStarted', (data) => {
            showScreen('question');
            document.getElementById('questionText').textContent = data.question;
            document.getElementById('currentRound').textContent = data.round;
            document.getElementById('totalRounds').textContent = data.total;
            document.getElementById('totalPlayers').textContent = data.total;
            playSound('start');
        });

        // –ü—Ä–æ–≥—Ä–µ—Å—Å –æ—Ç–≤–µ—Ç–æ–≤
        socket.on('answerProgress', (data) => {
            document.getElementById('answeredCount').textContent = data.current;
            const percent = (data.current / data.total) * 100;
            document.getElementById('answerProgressBar').style.width = percent + '%';
            playSound('submit');
        });

        // –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
        socket.on('votingStarted', (data) => {
            showScreen('voting');
            document.getElementById('votingQuestion').textContent = data.question;
            document.getElementById('totalVoters').textContent = data.answers.length;
            
            const showcase = document.getElementById('answersShowcase');
            showcase.innerHTML = data.answers.map((a, i) => `
                <div class="answer-option" style="animation-delay: ${i * 0.15}s">
                    <div class="answer-number">${i + 1}</div>
                    <div class="answer-content">
                        <div class="answer-text-big">${a.text}</div>
                    </div>
                </div>
            `).join('');
            playSound('voting');
        });

        socket.on('voteProgress', (data) => {
            document.getElementById('votedCount').textContent = data.current;
            const percent = (data.current / data.total) * 100;
            document.getElementById('voteProgressBar').style.width = percent + '%';
        });

        // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
        socket.on('roundResults', (results) => {
            showScreen('results');
            const podium = document.getElementById('resultsPodium');
            
            podium.innerHTML = results.map((r, i) => `
                <div class="result-row rank-${i + 1}" style="animation-delay: ${i * 0.2}s">
                    <div class="result-position">
                        ${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i + 1}`}
                    </div>
                    <div class="result-player-info">
                        <span class="result-avatar">${r.avatar}</span>
                        <span class="result-name">${r.name}</span>
                    </div>
                    <div class="result-answer-text">"${r.answer}"</div>
                    <div class="result-votes-display">
                        <span class="votes-num">${r.votes}</span>
                        <span class="votes-label">–≥–æ–ª–æ—Å–æ–≤</span>
                    </div>
                    <div class="result-score-display">${r.score}</div>
                </div>
            `).join('');
            playSound('results');
        });

        function nextRound() {
            socket.emit('nextRound');
        }

        socket.on('newRound', (data) => {
            showScreen('question');
            document.getElementById('questionText').textContent = data.question;
            document.getElementById('currentRound').textContent = data.round;
            document.getElementById('answeredCount').textContent = '0';
            document.getElementById('answerProgressBar').style.width = '0%';
            playSound('start');
        });

        // –§–∏–Ω–∞–ª
        socket.on('gameFinished', (scores) => {
            showScreen('final');
            const podium = document.getElementById('finalPodium');
            
            podium.innerHTML = scores.slice(0, 3).map((s, i) => `
                <div class="final-place place-${i + 1}">
                    <div class="final-rank">${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : 'ü•â'}</div>
                    <div class="final-avatar">${s.avatar}</div>
                    <div class="final-name">${s.name}</div>
                    <div class="final-score">${s.score} –æ—á–∫–æ–≤</div>
                </div>
            `).join('');
            playSound('winner');
        });

        socket.on('playerLeft', (data) => {
            updatePlayers(data.players);
        });

        socket.on('hostLeft', () => {
            alert('–•–æ—Å—Ç –ø–æ–∫–∏–Ω—É–ª –∏–≥—Ä—É!');
            location.reload();
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // –ü—Ä–æ—Å—Ç—ã–µ –∑–≤—É–∫–∏
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            const sounds = {
                join: [800, 0.1],
                start: [600, 0.2],
                submit: [1000, 0.1],
                voting: [700, 0.15],
                results: [900, 0.2],
                winner: [1200, 0.3]
            };
            
            const [freq, duration] = sounds[type] || [500, 0.1];
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            osc.frequency.value = freq;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            osc.start(audioContext.currentTime);
            osc.stop(audioContext.currentTime + duration);
        }
    </script>
</body>
</html>